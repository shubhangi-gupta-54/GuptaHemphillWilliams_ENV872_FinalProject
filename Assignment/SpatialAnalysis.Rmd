---
title: "SpatialAnalysis"
author: "Brook Hemphill"
date: "2024-03-29"
output: html_document
---


```{r Install packages, message=FALSE, warning=FALSE}
# Import the tidyverse library 
library(tidyverse, quietly = TRUE)
library(lubridate)
library(here)

# install.packages('sf')
library(sf)

# install.packages('leaflet')
library(leaflet)

# install.packages('mapview')
library(mapview)
mapviewOptions(fgb = FALSE)
# Load necessary libraries
library(ggplot2)

library(viridis)


# Disable on-the-fly projections
sf::sf_use_s2(FALSE)

```

## Part 1: READ IN THE DATASETS 

Start by importing, wrangling and exploring visually the Solar Footprint dataset. 

```{r cars}
#upload the datasets 
Solar.footprint <- st_read(here("~/GuptaHemphillWilliams_ENV872_FinalProject/SpatialData/Solar_Footprints_V2_-1101629766070969057 (2).geojson")) %>%
  select(COUNTYNAME, Type, Urban_Rural, Acres, geometry)

#explore the dataset

colnames(Solar.footprint)

#show the number of records
nrow(Solar.footprint)

#check coordinate system
st_crs(Solar.footprint)

#Reveal the extent of this dataset via the st_bbox() function
st_bbox(Solar.footprint)


#plot the data, colored by solar type
mapView(Solar.footprint, zcol = "Type")

```

## PART 1: READ IN DATASETS

Next, read in the USA counties shapefile, wrangle the dataset, and explore it visually.

```{r pressure, echo=FALSE}

#read in county data
counties_sf <- st_read(here("~/GuptaHemphillWilliams_ENV872_FinalProject/SpatialData/cb_2018_us_county_20m.shp"))

# Filter the data to only include California counties
ca_counties_sf <- counties_sf[counties_sf$STATEFP == "06", ]

st_read
#explore the dataset
colnames(counties_sf)

#show the number of records
nrow(counties_sf)

#check coordinate system
st_crs(counties_sf)

#Reveal the extent of this dataset via the st_bbox() function
st_bbox(counties_sf)

#view on map
plot(ca_counties_sf$geometry)

#plot the data, colored by COUNTYFP
mapView(ca_counties_sf, zcol = "COUNTYFP")


```

Now, read in the data for the Social Vulnerability Data. For our study, we focused on just a few variables: Estimates of people in poverty ("E_POV") and of minority population ("E_MINRTY"), keeping the location attributes as well. We also joined the SDI to the California counties dataset above.  

```{r pressure, echo=FALSE}
#Read the 2018 SVI county-level dataset for NC
svi2018_CA_raw <- read.csv("~/GuptaHemphillWilliams_ENV872_FinalProject/SpatialData/California_county.csv",
  colClasses = c('FIPS' = 'factor')) %>% 
  select(COUNTY, FIPS, LOCATION, E_TOTPOP, E_POV, E_MINRTY)


#Check structure
str(svi2018_CA_raw)

#Join the SVI attributes to the county spatial features
counties_sf_join <-  merge(x = ca_counties_sf,
                           y = svi2018_CA_raw, 
                           by.x = "GEOID", 
                           by.y = "FIPS" )

#Tidyverse version of the join
counties_sf_join <- ca_counties_sf %>% 
  left_join(svi2018_CA_raw, by = c("GEOID" = "FIPS") )




```
##PART 2: RESEARCH QUESTION 1

We will now begin our analysis for our research question: 

1. What county in California has the largest area in acres of industrial (large-scale) solar footprint and what is the dominant type of facility (i.e., rooftop, parking lot, or ground solar)? 

```{r}

# Group Solar Footprint data by COUNTYNAME and calculate sum of Acres
county_acres_sum <- Solar.footprint %>%
  group_by(COUNTYNAME) %>%
  summarise(total_acres = sum(Acres))

# Print the result
print(county_acres_sum)


# Filter the Solar Footprint data to only include Kern County
kern_solar <- Solar.footprint %>% 
  filter(COUNTYNAME == "Kern County")

# Summarize the total acres by solar facility type
kern_solar_types <- kern_solar %>%
  group_by(Type) %>%
  summarise(total_acres = sum(Acres))

# Print the results
print(kern_solar)
print(kern_solar_types)

#filter counties_sf for kern county 
kern_county_boundary <- counties_sf %>%
  filter(NAME == "Kern")

#filter for dominant type
kern_ground_footprint <- kern_solar_types %>%
  filter(Type == "Ground")

#visualize kern county and dominant footprint type

kern_county_map <- mapview(kern_county_boundary, col.regions = "orange") + 
   mapview(kern_ground_footprint, zcol = "Type", col.regions = "black", legend = TRUE)

print(kern_county_map)

```

The output shows that the county in California with the largest total solar footprint in acres is Kern County, with a total of 31120.0 acres. The output shows that the dominant type of solar facility in Kern County is Ground, with 30831.1 acres. This indicates that Kern County has the largest area of industrial (large-scale) ground-mounted solar footprint in California.

## RESEARCH QUESTION 2

What is the spatial distribution of industrial solar footprints and minority population size in California? What county in California has the highest minority population ranking and what is the dominant type of industrial solar footprint? 

```{r}

#visualize with mapview
CA_E_MINRTY_map <- mapview(counties_sf_join, 
                           zcol = 'E_MINRTY', 
                           colorpalette = "viridis") + 
  mapview(Solar.footprint, 
          zcol = "Type", 
          col.region = c("red", "green", "blue"))

print(CA_E_MINRTY_map)


# Filter the Solar Footprint data to only include KLA 
LA_solar <- Solar.footprint %>% 
  filter(COUNTYNAME == "Los Angeles County")

# Summarize the total acres by solar facility type
LA_solar_types <- LA_solar %>%
  group_by(Type) %>%
  summarise(total_acres = sum(Acres))

# Print the results
print(LA_solar)
print(LA_solar_types)

#filter counties_sf for kern county 
LA_county_boundary <- counties_sf %>%
  filter(NAME == "Los Angeles")

#filter for dominant type
LA_ground_footprint <- LA_solar_types %>%
  filter(Type == "Ground")



#visualize CA_highest_E_MINRTY and LA_solar to determine dominant solar type
Dominant_solar_LA <- mapview(LA_county_boundary) + mapview(LA_solar_types, zcol = "Type", col.region = c("red", "green", "pink"))
print(Dominant_solar_LA)

```
From the CA_highest_E_MINRTY map, it is clear that Los Angeles contains the highest minority population, with 7439000 people. Similar to research question one, the dominant solar footprint type is ground, at 9490.9 acres.
 

